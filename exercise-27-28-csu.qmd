---
title: "Daily Exercise 27-28"
subtitle: 'Ecosystem Science and Sustainability 330'
author:
  - name: Leona Myers
    email: "leona18@colostate.edu"
format: html
execute:
  echo: true
---
```{r setup, include=FALSE}
# Load necessary libraries
library(sf)
library(dplyr)
library(terra)
library(ggplot2)
library(tmap)
library(tidyverse)
library(osmdata)
```

## Load and Process Spatial Data

```{r}
fc <- getbb("Fort Collins, Colorado")

bbox_coords <- c(fc["x", "min"], fc["y", "min"],
                 fc["x", "max"], fc["y", "min"],
                 fc["x", "max"], fc["y", "max"],
                 fc["x", "min"], fc["y", "max"],
                 fc["x", "min"], fc["y", "min"])

fc_sf <- st_as_sf(st_sfc(st_polygon(list(matrix(bbox_coords, ncol = 2, byrow = TRUE)))))
```

## Extract River Data

```{r}
foco_rivers <- opq(st_bbox(fc_sf)) |>
  add_osm_feature("waterway") |>
  osmdata_sf()

Sys.setenv(AWS_NO_SIGN_REQUEST = "YES") 
dem <- rast('/vsis3/lynker-spatial/gridded-resources/dem.vrt')

poudre <- foco_rivers$osm_lines %>%
  filter(grepl("Cache la Poudre", name, ignore.case = TRUE)) %>%
  st_transform(crs(dem)) %>% 
  st_union() %>%
  st_as_sf()
print(poudre)
```

## Convert River Data to Points

```{r}
poudre_pts <- st_cast(poudre, "POINT")
print(paste("Class of Poudre points:", class(poudre_pts)))
poudre_pts_vect <- terra::vect(poudre_pts)
print(paste("Class of Poudre points (terra vector):", class(poudre_pts_vect)))  
```

## Extract Elevation Values

```{r}
elev_vals <- terra::extract(dem, poudre_pts_vect)

profile_data <- bind_cols(poudre_pts, elev_vals) %>%
  mutate(ID = row_number())

head(profile_data)
```

## Plot Elevation Profile

```{r}
ggplot(profile_data, aes(x = ID, y = dem)) +
  geom_line(color = "blue") +
  labs(title = "Elevation Profile of Cache la Poudre River",
       x = "Point ID",
       y = "Elevation (m)") +
  theme_minimal()
```


```{r}
ggplot(profile_data) +
  geom_sf(aes(color = dem), size = 0.8) +
  scale_color_viridis_c(name = "Elevation (cm)") +
  labs(title = "Cache la Poudre River with Elevation Gradient") +
  theme_minimal()
```

